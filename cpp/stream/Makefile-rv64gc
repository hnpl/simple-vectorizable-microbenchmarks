CC = /riscv/_install/bin/riscv64-unknown-linux-gnu-gcc
OUTPUT_PATH ?= .
N_THREADS ?= 8
#CFLAGS = -O2 -fopenmp -static -march=rv64gcv -ftree-vectorize -ftree-vectorizer-verbose=5 -ffast-math -fassociative-math
CFLAGS = -O2 -fopenmp -static -march=rv64gc
SUFFIX=riscv.$(ARRAY_SIZE).$(N_THREADS)t

# if both m5ops_header_path and m5_build_path are defined, we build the STREAM benchmark with the m5 annotations
ifneq ($(M5_BUILD_PATH),)
  CFLAGS += -I$(M5OPS_HEADER_PATH)
  CFLAGS += -O -DGEM5_ANNOTATION=1 
  LDFLAGS += -lm5 -L$(M5_BUILD_PATH)/out/
  TMP_SUFFIX = $(SUFFIX)
  SUFFIX := $(TMP_SUFFIX).m5
endif

all: stream_c

stream_c: stream.c
	$(CC) $(CFLAGS) -O -DARRAY_SIZE=$(ARRAY_SIZE) -DNTIMES=2 -DN_THREADS=$(N_THREADS) stream.c -o $(OUTPUT_PATH)/stream_c.$(SUFFIX) $(LDFLAGS)

clean:
	rm -f *.o stream_c.*

